/*!
 * # Semantic UI 2.0.3 - API
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
(function(n,t,i,r){"use strict";n.api=n.fn.api=function(i){var o=n.isFunction(this)?n(t):n(this),s=o.selector||"",e=(new Date).getTime(),f=[],h=arguments[0],c=typeof h=="string",l=[].slice.call(arguments,1),u;return o.each(function(){var o=n.isPlainObject(i)?n.extend(!0,{},n.fn.api.settings,i):n.extend({},n.fn.api.settings),p=o.namespace,w=o.metadata,b=o.selector,a=o.error,v=o.className,k="."+p,y="module-"+p;request;$module=n(this);$form=$module.closest(b.form);$context=o.stateContext?n(o.stateContext):$module;ajaxSettings;requestSettings;url;data;requestStartTime;element=this;context=$context[0];instance=$module.data(y);module;module={initialize:function(){c||module.bind.events();module.instantiate()},instantiate:function(){module.verbose("Storing instance of module",module);instance=module;$module.data(y,instance)},destroy:function(){module.verbose("Destroying previous module for",element);$module.removeData(y).off(k)},bind:{events:function(){var n=module.get.event();if(n){module.verbose("Attaching API events to element",n);$module.on(n+k,module.event.trigger)}else o.on=="now"&&(module.debug("Querying API now",n),module.query())}},read:{cachedResponse:function(n){var i;if(t.Storage===r){module.error(a.noStorage);return}if(i=sessionStorage.getItem(n),module.debug("Using cached response",n,i),i!==r){try{i=JSON.parse(i)}catch(u){}return i}return!1}},write:{cachedResponse:function(i,u){if(u&&u===""){module.debug("Response empty, not caching",u);return}if(t.Storage===r){module.error(a.noStorage);return}n.isPlainObject(u)&&(u=JSON.stringify(u));sessionStorage.setItem(i,u);module.verbose("Storing cached response for url",i,u)}},query:function(){if(module.is.disabled()){module.debug("Element is disabled API request aborted");return}if(module.is.loading())if(o.interruptRequests)module.debug("Interrupting previous request"),module.abort();else{module.debug("Cancelling request, previous request is still pending");return}if(o.defaultData&&n.extend(!0,o.urlData,module.get.defaultData()),o.serializeForm&&(o.data=module.add.formData(o.data)),requestSettings=module.get.settings(),requestSettings===!1){module.cancelled=!0;module.error(a.beforeSend);return}if(module.cancelled=!1,url=module.get.templatedURL(),!url&&!module.is.mocked()){module.error(a.missingURL);return}if(url=module.add.urlData(url),url||module.is.mocked()){if(ajaxSettings=n.extend(!0,{},o,{type:o.method||o.type,data:data,url:o.base+url,beforeSend:o.beforeXHR,success:function(){},failure:function(){},complete:function(){}}),module.debug("Querying URL",ajaxSettings.url),module.verbose("Using AJAX settings",ajaxSettings),o.cache==="local"&&module.read.cachedResponse(url)){module.debug("Response returned from local cache");module.request=module.create.request();module.request.resolveWith(context,[module.read.cachedResponse(url)]);return}o.throttle?o.throttleFirstRequest||module.timer?(module.debug("Throttling request",o.throttle),clearTimeout(module.timer),module.timer=setTimeout(function(){module.timer&&delete module.timer;module.debug("Sending throttled request",data,ajaxSettings.method);module.send.request()},o.throttle)):(module.debug("Sending request",data,ajaxSettings.method),module.send.request(),module.timer=setTimeout(function(){},o.throttle)):(module.debug("Sending request",data,ajaxSettings.method),module.send.request())}},is:{disabled:function(){return $module.filter(b.disabled).length>0},form:function(){return $module.is("form")},mocked:function(){return o.mockResponse||o.mockResponseAsync},input:function(){return $module.is("input")},loading:function(){return module.request&&module.request.state()=="pending"},abortedRequest:function(n){return n&&n.readyState!==r&&n.readyState===0?(module.verbose("XHR request determined to be aborted"),!0):(module.verbose("XHR request was not aborted"),!1)},validResponse:function(t){return o.dataType!=="json"||!n.isFunction(o.successTest)?(module.verbose("Response is not JSON, skipping validation",o.successTest,t),!0):(module.debug("Checking JSON returned success",o.successTest,t),o.successTest(t)?(module.debug("Response passed success test",t),!0):(module.debug("Response failed success test",t),!1))}},was:{cancelled:function(){return module.cancelled||!1},succesful:function(){return module.request&&module.request.state()=="resolved"},failure:function(){return module.request&&module.request.state()=="rejected"},complete:function(){return module.request&&(module.request.state()=="resolved"||module.request.state()=="rejected")}},add:{urlData:function(t,i){var u,f;return t&&(u=t.match(o.regExp.required),f=t.match(o.regExp.optional),i=i||o.urlData,u&&(module.debug("Looking for required URL variables",u),n.each(u,function(u,f){var e=f.indexOf("$")!==-1?f.substr(2,f.length-3):f.substr(1,f.length-2),o=n.isPlainObject(i)&&i[e]!==r?i[e]:$module.data(e)!==r?$module.data(e):$context.data(e)!==r?$context.data(e):i[e];if(o===r)return module.error(a.requiredParameter,e,t),t=!1,!1;module.verbose("Found required variable",e,o);t=t.replace(f,o)})),f&&(module.debug("Looking for optional URL variables",u),n.each(f,function(u,f){var e=f.indexOf("$")!==-1?f.substr(3,f.length-4):f.substr(2,f.length-3),o=n.isPlainObject(i)&&i[e]!==r?i[e]:$module.data(e)!==r?$module.data(e):$context.data(e)!==r?$context.data(e):i[e];o!==r?(module.verbose("Optional variable Found",e,o),t=t.replace(f,o)):(module.verbose("Optional variable not found",e),t=t.indexOf("/"+f)!==-1?t.replace("/"+f,""):t.replace(f,""))}))),t},formData:function(t){var u=n.fn.serializeObject!==r,i=u?$form.serializeObject():$form.serialize(),f;return t=t||o.data,f=n.isPlainObject(t),f?u?(module.debug("Extending existing data with form data",t,i),t=n.extend(!0,{},t,i)):(module.error(a.missingSerialize),module.debug("Cant extend data. Replacing data with form data",t,i),t=i):(module.debug("Adding form data",i),t=i),t}},send:{request:function(){module.set.loading();module.request=module.create.request();module.is.mocked()?module.mockedXHR=module.create.mockedXHR():module.xhr=module.create.xhr();o.onRequest.call(context,module.request,module.xhr)}},event:{trigger:function(n){module.query();(n.type=="submit"||n.type=="click")&&n.preventDefault()},xhr:{always:function(){},done:function(t,i,r){var f=this,s=(new Date).getTime()-requestStartTime,u=o.loadingDuration-s,e=n.isFunction(o.onResponse)?o.onResponse.call(f,n.extend(!0,{},t)):!1;u=u>0?u:0;e&&(module.debug("Modified API response in onResponse callback",o.onResponse,e,t),t=e);u>0&&module.debug("Response completed early delaying state change by",u);setTimeout(function(){module.is.validResponse(t)?module.request.resolveWith(f,[t]):module.request.rejectWith(f,[r,"invalid"])},u)},fail:function(n,t,i){var u=this,f=(new Date).getTime()-requestStartTime,r=o.loadingDuration-f;r=r>0?r:0;r>0&&module.debug("Response completed early delaying state change by",r);setTimeout(function(){module.is.abortedRequest(n)?module.request.rejectWith(u,[n,"aborted",i]):module.request.rejectWith(u,[n,"error",t,i])},r)}},request:{complete:function(n){module.remove.loading();o.onComplete.call(context,n,$module)},done:function(n){module.debug("Successful API Response",n);o.cache==="local"&&url&&(module.write.cachedResponse(url,n),module.debug("Saving server response locally",module.cache));o.onSuccess.call(context,n,$module)},fail:function(t,i,u){var f=n.isPlainObject(t)?t.responseText:!1,e=n.isPlainObject(f)&&f.error!==r?f.error:o.error[i]!==r?o.error[i]:u;i=="aborted"?(module.debug("XHR Aborted (Most likely caused by page navigation or CORS Policy)",i,u),o.onAbort.call(context,i,$module)):i=="invalid"?module.debug("JSON did not pass success test. A server-side error has most likely occurred",f):i=="error"&&t!==r&&(module.debug("XHR produced a server error",i,u),t.status!=200&&u!==r&&u!==""&&module.error(a.statusMessage+u,ajaxSettings.url),o.onError.call(context,e,$module));o.errorDuration&&i!=="aborted"&&(module.debug("Adding error state"),module.set.error(),setTimeout(module.remove.error,o.errorDuration));module.debug("API Request failed",e,t);o.onFailure.call(context,f,$module)}}},create:{request:function(){return n.Deferred().always(module.event.request.complete).done(module.event.request.done).fail(module.event.request.fail)},mockedXHR:function(){var r=!1,f=!1,e=!1,u,i,t;return t=n.Deferred().always(module.event.xhr.complete).done(module.event.xhr.done).fail(module.event.xhr.fail),o.mockResponse?(n.isFunction(o.mockResponse)?(module.debug("Using mocked callback returning response",o.mockResponse),i=o.mockResponse.call(context,o)):(module.debug("Using specified response",o.mockResponse),i=o.mockResponse),t.resolveWith(context,[i,r,{responseText:i}])):n.isFunction(o.mockResponseAsync)&&(u=function(n){module.debug("Async callback returned response",n);n?t.resolveWith(context,[n,r,{responseText:n}]):t.rejectWith(context,[{responseText:n},f,e])},module.debug("Using async mocked response",o.mockResponseAsync),o.mockResponseAsync.call(context,o,u)),t},xhr:function(){var t;return t=n.ajax(ajaxSettings).always(module.event.xhr.always).done(module.event.xhr.done).fail(module.event.xhr.fail),module.verbose("Created server request",t),t}},set:{error:function(){module.verbose("Adding error state to element",$context);$context.addClass(v.error)},loading:function(){module.verbose("Adding loading state to element",$context);$context.addClass(v.loading);requestStartTime=(new Date).getTime()}},remove:{error:function(){module.verbose("Removing error state from element",$context);$context.removeClass(v.error)},loading:function(){module.verbose("Removing loading state from element",$context);$context.removeClass(v.loading)}},get:{request:function(){return module.request||!1},xhr:function(){return module.xhr||!1},settings:function(){var n;return n=o.beforeSend.call(context,o),n&&(n.success!==r&&(module.debug("Legacy success callback detected",n),module.error(a.legacyParameters,n.success),n.onSuccess=n.success),n.failure!==r&&(module.debug("Legacy failure callback detected",n),module.error(a.legacyParameters,n.failure),n.onFailure=n.failure),n.complete!==r&&(module.debug("Legacy complete callback detected",n),module.error(a.legacyParameters,n.complete),n.onComplete=n.complete)),n===r&&module.error(a.noReturnedValue),n!==r?n:o},defaultData:function(){var t={};return n.isWindow(element)||(module.is.input()?t.value=$module.val():module.is.form()&&(t.text=$module.text())),t},event:function(){return n.isWindow(element)||o.on=="now"?(module.debug("API called without element, no events attached"),!1):o.on=="auto"?$module.is("input")?element.oninput!==r?"input":element.onpropertychange!==r?"propertychange":"keyup":$module.is("form")?"submit":"click":o.on},templatedURL:function(n){if(n=n||$module.data(w.action)||o.action||!1,url=$module.data(w.url)||o.url||!1,url)return module.debug("Using specified url",url),url;if(n){if(module.debug("Looking up url for action",n,o.api),o.api[n]===r&&!module.is.mocked()){module.error(a.missingAction,o.action,o.api);return}url=o.api[n]}else module.is.form()&&(url=$module.attr("action")||!1,module.debug("No url or action specified, defaulting to form action",url));return url}},abort:function(){var n=module.get.xhr();n&&n.state()!=="resolved"&&(module.debug("Cancelling API request"),n.abort())},reset:function(){module.remove.error();module.remove.loading()},setting:function(t,i){if(module.debug("Changing setting",t,i),n.isPlainObject(t))n.extend(!0,o,t);else if(i!==r)o[t]=i;else return o[t]},internal:function(t,i){if(n.isPlainObject(t))n.extend(!0,module,t);else if(i!==r)module[t]=i;else return module[t]},debug:function(){o.debug&&(o.performance?module.performance.log(arguments):(module.debug=Function.prototype.bind.call(console.info,console,o.name+":"),module.debug.apply(console,arguments)))},verbose:function(){o.verbose&&o.debug&&(o.performance?module.performance.log(arguments):(module.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),module.verbose.apply(console,arguments)))},error:function(){module.error=Function.prototype.bind.call(console.error,console,o.name+":");module.error.apply(console,arguments)},performance:{log:function(n){var t,i,r;o.performance&&(t=(new Date).getTime(),r=e||t,i=t-r,e=t,f.push({Name:n[0],Arguments:[].slice.call(n,1)||"","Execution Time":i}));clearTimeout(module.performance.timer);module.performance.timer=setTimeout(module.performance.display,500)},display:function(){var t=o.name+":",i=0;e=!1;clearTimeout(module.performance.timer);n.each(f,function(n,t){i+=t["Execution Time"]});t+=" "+i+"ms";s&&(t+=" '"+s+"'");(console.group!==r||console.table!==r)&&f.length>0&&(console.groupCollapsed(t),console.table?console.table(f):n.each(f,function(n,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd());f=[]}},invoke:function(t,i,f){var e=instance,h,o,s;return i=i||l,f=element||f,typeof t=="string"&&e!==r&&(t=t.split(/[\. ]/),h=t.length-1,n.each(t,function(i,u){var f=i!=h?u+t[i+1].charAt(0).toUpperCase()+t[i+1].slice(1):t;if(n.isPlainObject(e[f])&&i!=h)e=e[f];else{if(e[f]!==r)return o=e[f],!1;if(n.isPlainObject(e[u])&&i!=h)e=e[u];else return e[u]!==r?(o=e[u],!1):(module.error(a.method,t),!1)}})),n.isFunction(o)?s=o.apply(f,i):o!==r&&(s=o),n.isArray(u)?u.push(s):u!==r?u=[u,s]:s!==r&&(u=s),o}};c?(instance===r&&module.initialize(),module.invoke(h)):(instance!==r&&instance.invoke("destroy"),module.initialize())}),u!==r?u:this};n.api.settings={name:"API",namespace:"api",debug:!0,verbose:!1,performance:!0,api:{},cache:!0,interruptRequests:!0,on:"auto",stateContext:!1,loadingDuration:0,errorDuration:2e3,action:!1,url:!1,base:"",urlData:{},defaultData:!0,serializeForm:!1,throttle:0,throttleFirstRequest:!0,method:"get",data:{},dataType:"json",mockResponse:!1,mockResponseAsync:!1,beforeSend:function(n){return n},beforeXHR:function(){},onRequest:function(){},onResponse:!1,onSuccess:function(){},onComplete:function(){},onFailure:function(){},onError:function(){},onAbort:function(){},successTest:!1,error:{beforeSend:"The before send function has aborted the request",error:"There was an error with your request",exitConditions:"API Request Aborted. Exit conditions met",JSONParse:"JSON could not be parsed during error handling",legacyParameters:"You are using legacy API success callback names",method:"The method you called is not defined",missingAction:"API action used but no url was defined",missingSerialize:"jquery-serialize-object is required to add form data to an existing data object",missingURL:"No URL specified for api event",noReturnedValue:"The beforeSend callback must return a settings object, beforeSend ignored.",noStorage:"Caching respopnses locally requires session storage",parseError:"There was an error parsing your request",requiredParameter:"Missing a required URL parameter: ",statusMessage:"Server gave an error: ",timeout:"Your request timed out"},regExp:{required:/\{\$*[A-z0-9]+\}/g,optional:/\{\/\$*[A-z0-9]+\}/g},className:{loading:"loading",error:"error"},selector:{disabled:".disabled",form:"form"},metadata:{action:"action",url:"url"}}})(jQuery,window,document);
//# sourceMappingURL=api.min.js.map
